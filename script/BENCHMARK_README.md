
Create the benchmarking tarball
===============================

The first step is to run the build script.

    $ cd pbbs-sptl/script
    $ ./create-benchmark-nix-package.sh

If the script completes successfully, there will be a file named
`benchmark-pbbs-sptl.tar.gz` in the current directory.

Install the benchmarking package
================================

Once you have the benchmarking tarball, unpack the tarball in a
temporary folder.

    $ tar -xvzf benchmark-pbbs-sptl.tar.gz

Now, run the following command.

    $ nix-build -E 'with (import <nixpkgs> {}); callPackage ./benchmark-pbbs-sptl/pbbs-sptl/script/benchmark.nix { }'

Alternatively, if you already have a copy of the input data, then run
the following command instead, pointing `preExistingDataFolder` to the
folder.

    $ nix-build -E 'with (import <nixpkgs> {}); callPackage ./benchmark-pbbs-sptl/pbbs-sptl/script/benchmark.nix { preExistingDataFolder="<path to your custom folder>"; }'

If the command succeeds, there will be a symlink named `result` in the
current directory.

Create a workspace for the experiment
=====================================

The next step is to create a scratch space in which to run the
experiments.

    $ ./result/bin/install-script

Start running an experiment
===========================

We can now change to the scratch folder and build the benchmarking
tool.

    $ cd bench
    $ make bench.pbench

Because there are some runtime dependencies on the nix `gcc` package,
we need to enter the environment of the nix shell, seeded with `gcc`.

    $ nix-shell -p gcc

It may be convenient to use nix to install various other runtime
package dependencies, especially if the benchmarking system does not
already have the dependencies installed.

At a minimum, to build the benchmark script, the system should have
installed on it the `ocaml_4_03` package.

If the system does not already have a copy of the input data, then the
data can be obtained by the `ipfs` package.

Plots are generated by the benchmarking script using the `R` and
`texlive.combined.scheme-full` packages. The latter package is quite
large. So, it may save time and bandwidth to first check if the system
has already installed on it a full TexLive bundle.

We can now try to run one of the benchmark programs, say,
`convexhull`.

    $ ./bench.pbench compare -benchmark convexhull

If the runs completed successfully, then there should be a file named
`tables_compare.pdf` in the current directory.